<div
  class="data-table-card relative flex flex-col h-full bg-white shadow-md rounded-lg overflow-hidden m-4"
>
  <!-- Header Section -->
  <div
    class="bg-gradient-to-r from-gray-50 to-white py-3 px-4 border-b border-gray-200 flex flex-wrap gap-3 items-center justify-between"
  >
    <!-- Search Input -->
    <div *ngIf="showSearch" class="flex items-center w-1/3">
      <div class="relative w-full">
        <div
          class="absolute inset-y-0 flex items-center pointer-events-none"
          [ngClass]="{ 'left-0 pl-2': !isRtl, 'right-0 pr-2': isRtl }"
        >
          <i class="fas fa-search text-gray-400 text-sm"></i>
        </div>
        <input
          type="text"
          [(ngModel)]="searchTerm"
          (keyup)="onSearch()"
          [placeholder]="'dataTable.searchPlaceholder' | translate"
          class="form-control w-full border border-gray-300 rounded-lg py-1.5 text-sm focus:ring focus:ring-opacity-50"
          [ngClass]="{ 'pl-8 pr-3': !isRtl, 'pr-8 pl-3': isRtl }"
        />
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="flex items-center gap-2">
      <!-- Add Button -->
      <button
        (click)="onAdd()"
        class="bg-primary-600 hover:bg-primary-700 text-white px-3 py-1.5 rounded-lg flex items-center gap-1.5 transition-colors duration-200 text-sm"
        [title]="'common.addNew' | translate"
      >
        <i class="fas fa-plus h-3 w-3"></i>
        <span>{{ "common.add" | translate }}</span>
      </button>

      <!-- Refresh Button -->
      <button
        *ngIf="showRefresh"
        (click)="onRefresh()"
        class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-1.5 rounded-lg flex items-center gap-1.5 transition-colors duration-200 text-sm"
        [title]="'common.refresh' | translate"
      >
        <i class="fas fa-sync-alt h-3 w-3"></i>
        <span>{{ "common.refresh" | translate }}</span>
      </button>
    </div>
  </div>

  <!-- Empty State -->
  <div
    *ngIf="data.length === 0 && !loading"
    class="empty-state py-16 flex flex-col items-center justify-center"
  >
    <i class="{{ emptyIcon }} text-6xl text-gray-400 mb-4"></i>
    <h3 class="text-lg font-medium mb-1 mt-4">{{ emptyMessage }}</h3>
  </div>

  <!-- Loading Placeholder -->
  <div
    *ngIf="loading && data.length === 0"
    class="py-16 flex flex-col items-center justify-center"
  >
    <div class="spinner-container">
      <div class="spinner"></div>
      <p class="mt-4 text-primary-600 font-medium">Loading data...</p>
    </div>
  </div>

  <!-- Small loading indicator when refreshing with existing data -->
  <div *ngIf="loading && data.length > 0" class="absolute top-4 right-4 z-10">
    <div class="spinner" style="width: 20px; height: 20px"></div>
  </div>

  <!-- Table -->
  <div class="overflow-x-auto" *ngIf="data.length > 0">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th
            *ngFor="let column of columns"
            [scope]="'col'"
            [class]="
              'px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider'
            "
            [class.cursor-pointer]="column.sortable"
            [class.hover:bg-gray-100]="column.sortable"
            [class.select-none]="column.sortable"
            [class.text-left]="!isRtl && column.align !== 'right'"
            [class.text-center]="column.align === 'center'"
            [class.text-right]="isRtl || column.align === 'right'"
            [style.width]="column.width"
            (click)="column.sortable ? onSort(column.key) : null"
          >
            <div
              class="flex items-center gap-1"
              [class.justify-center]="column.align === 'center'"
              [class.justify-end]="isRtl || column.align === 'right'"
              [class.flex-row-reverse]="isRtl && column.align !== 'center'"
            >
              <span>{{ column.label | translate }}</span>
              <i
                *ngIf="column.sortable"
                class="fas fa-sort text-gray-400"
                [class.fa-sort-up]="
                  sortField === column.key && sortDirection === 'asc'
                "
                [class.fa-sort-down]="
                  sortField === column.key && sortDirection === 'desc'
                "
                [class.text-primary-600]="sortField === column.key"
              ></i>
            </div>
          </th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
        <tr *ngFor="let item of data" class="hover:bg-gray-50">
          <td
            *ngFor="let column of columns"
            [class]="'px-6 py-4 whitespace-nowrap text-sm'"
            [class.text-left]="!isRtl && column.align !== 'right'"
            [class.text-center]="column.align === 'center'"
            [class.text-right]="isRtl || column.align === 'right'"
          >
            <!-- Avatar Type -->
            <div *ngIf="column.type === 'avatar'" class="flex items-center">
              <div class="flex-shrink-0 h-10 w-10">
                <!-- Show image if available -->
                <img
                  *ngIf="item.photoUrl"
                  [src]="getImageUrl(item.photoUrl)"
                  [alt]="getCellValue(item, column)"
                  class="h-10 w-10 rounded-full object-cover border-2 border-gray-200"
                  (error)="onImageError($event)"
                />
                <!-- Show initials if no image -->
                <div
                  *ngIf="!item.photoUrl"
                  class="h-10 w-10 rounded-full bg-primary-100 flex items-center justify-center"
                >
                  <span class="text-primary-600 font-medium">
                    {{ getAvatarText(item, column) }}
                  </span>
                </div>
              </div>
              <div [ngClass]="{ 'ml-4': !isRtl, 'mr-4': isRtl }">
                <div class="text-sm font-medium text-gray-900">
                  {{ getCellValue(item, column) }}
                </div>
                <div class="text-sm text-gray-500">{{ column.label }}</div>
              </div>
            </div>

            <!-- Status Type -->
            <span
              *ngIf="column.type === 'status'"
              [class]="
                'px-2 inline-flex text-xs leading-5 font-semibold rounded-full ' +
                getStatusClass(getCellValue(item, column))
              "
            >
              {{ getCellValue(item, column) }}
            </span>

            <!-- Date Type -->
            <span *ngIf="column.type === 'date'" class="text-gray-900">
              {{ formatDate(getCellValue(item, column)) }}
            </span>

            <!-- Actions Type -->
            <div
              *ngIf="column.type === 'actions'"
              class="flex items-center justify-end gap-2 actions-row"
            >
              <ng-container *ngFor="let action of actions">
                <button
                  *ngIf="!action.show || action.show(item)"
                  (click)="onActionClick(action.action, item)"
                  [class]="
                    'inline-flex items-center px-3 py-1.5 border rounded-md transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-opacity-50 focus:color-white' +
                    getActionColorClass(action.color)
                  "
                  [title]="(action.label | translate) || ''"
                >
                  <i
                    class="{{ action.icon }}"
                    [ngClass]="{ 'mr-1': !isRtl, 'ml-1': isRtl }"
                  ></i>
                  <span class="text-xs">{{ action.label | translate }}</span>
                </button>
              </ng-container>
            </div>

            <!-- Default Text Type -->
            <span
              *ngIf="!column.type || column.type === 'text'"
              class="text-gray-900"
            >
              {{ getCellValue(item, column) }}
            </span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div
    *ngIf="showPagination && pagination && data.length > 0"
    class="flex flex-col sm:flex-row items-center justify-between bg-gray-50 p-4 border-t border-gray-200"
  >
    <div class="text-sm text-gray-500 mb-2 sm:mb-0">
      <div>
        {{ "dataTable.footer.showing" | translate }}
        {{ (pagination.currentPage - 1) * pagination.pageSize + 1 }}
        {{ "dataTable.footer.to" | translate }}
        {{
          Math.min(
            pagination.currentPage * pagination.pageSize,
            pagination.totalItems
          )
        }}
        {{ "dataTable.footer.of" | translate }}
        {{ pagination.totalItems }}
        {{ "dataTable.footer.entries" | translate }}
        <span *ngIf="searchTerm.trim()" class="text-blue-600">
          ({{ "dataTable.footer.filtered" | translate }})
        </span>
      </div>
    </div>
    <div class="flex items-center gap-2">
      <select
        [(ngModel)]="pagination.pageSize"
        (ngModelChange)="onPageSizeChange($event)"
        class="text-sm border border-gray-300 rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-primary-500"
      >
        <option [value]="5">
          5 {{ "dataTable.footer.perPage" | translate }}
        </option>
        <option [value]="10">
          10 {{ "dataTable.footer.perPage" | translate }}
        </option>
        <option [value]="20">
          20 {{ "dataTable.footer.perPage" | translate }}
        </option>
        <option [value]="50">
          50 {{ "dataTable.footer.perPage" | translate }}
        </option>
      </select>
      <div class="flex gap-1">
        <button
          class="px-3 py-1 rounded border border-gray-300 text-sm hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed"
          [disabled]="pagination.currentPage === 1"
          (click)="onPageChange(1)"
          [title]="'dataTable.footer.firstPage' | translate"
        >
          <i
            class="fas"
            [ngClass]="{
              'fa-angle-double-left': !isRtl,
              'fa-angle-double-right': isRtl
            }"
          ></i>
        </button>
        <button
          class="px-3 py-1 rounded border border-gray-300 text-sm hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed"
          [disabled]="pagination.currentPage === 1"
          (click)="onPageChange(pagination.currentPage - 1)"
          [title]="'dataTable.footer.prevPage' | translate"
        >
          <i
            class="fas"
            [ngClass]="{ 'fa-chevron-left': !isRtl, 'fa-chevron-right': isRtl }"
          ></i>
        </button>
        <div class="flex gap-1">
          <button
            *ngFor="let page of getPaginationRange()"
            (click)="onPageChange(page)"
            class="px-3 py-1 rounded border text-sm min-w-[32px]"
            [ngClass]="{
              'bg-primary-600 text-white border-primary-600':
                pagination.currentPage === page,
              'border-gray-300 hover:bg-gray-100':
                pagination.currentPage !== page
            }"
          >
            {{ page }}
          </button>
        </div>
        <button
          class="px-3 py-1 rounded border border-gray-300 text-sm hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed"
          [disabled]="pagination.currentPage === pagination.totalPages"
          (click)="onPageChange(pagination.currentPage + 1)"
          [title]="'dataTable.footer.nextPage' | translate"
        >
          <i
            class="fas"
            [ngClass]="{ 'fa-chevron-right': !isRtl, 'fa-chevron-left': isRtl }"
          ></i>
        </button>
        <button
          class="px-3 py-1 rounded border border-gray-300 text-sm hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed"
          [disabled]="pagination.currentPage === pagination.totalPages"
          (click)="onPageChange(pagination.totalPages)"
          [title]="'dataTable.footer.lastPage' | translate"
        >
          <i
            class="fas"
            [ngClass]="{
              'fa-angle-double-right': !isRtl,
              'fa-angle-double-left': isRtl
            }"
          ></i>
        </button>
      </div>
    </div>
  </div>
</div>
