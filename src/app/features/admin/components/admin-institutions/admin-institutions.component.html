<!-- Page Header -->
<div class="m-4 flex justify-between items-center">
  <div>
    <h1 class="text-2xl font-bold text-gray-900">Institutions</h1>
    <p class="text-gray-600">Manage institutions in the system</p>
  </div>
</div>

<!-- Data Table Component -->
<app-data-table
  [columns]="tableColumns"
  [data]="institutions"
  [loading]="loading"
  [emptyMessage]="'No institutions found'"
  [emptyIcon]="'fas fa-university'"
  [actions]="tableActions"
  [pagination]="paginationInfo"
  [searchTerm]="searchTerm"
  [showSearch]="true"
  [showPagination]="true"
  [showRefresh]="false"
  (sort)="onTableSort($event)"
  (search)="onTableSearch($event)"
  (refresh)="onTableRefresh()"
  (add)="onTableAdd()"
  (pageChange)="onTablePageChange($event)"
  (pageSizeChange)="onTablePageSizeChange($event)"
  (actionClick)="onTableActionClick($event)"
></app-data-table>

<!-- Add/Edit Institution Modal -->
<app-modal
  [show]="showModal"
  [title]="isEditing ? 'Edit Institution' : 'Add Institution'"
  (close)="closeModal()"
>
  <form (ngSubmit)="saveInstitution()" #institutionForm="ngForm">
    <div class="space-y-4">
      <!-- Name English -->
      <div>
        <label
          for="nameEn"
          class="block text-sm font-medium text-gray-700 mb-1"
        >
          Name (English) *
        </label>
        <input
          type="text"
          id="nameEn"
          name="nameEn"
          [(ngModel)]="formData.nameEn"
          required
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
          placeholder="Enter English name"
        />
      </div>

      <!-- Name Arabic -->
      <div>
        <label
          for="nameAr"
          class="block text-sm font-medium text-gray-700 mb-1"
        >
          Name (Arabic) *
        </label>
        <input
          type="text"
          id="nameAr"
          name="nameAr"
          [(ngModel)]="formData.nameAr"
          required
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
          placeholder="Enter Arabic name"
        />
      </div>
    </div>

    <!-- Modal Actions -->
    <div class="flex justify-end space-x-3 mt-6">
      <button
        type="button"
        (click)="closeModal()"
        class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-200"
      >
        Cancel
      </button>
      <button
        type="submit"
        [disabled]="institutionForm.invalid || submitting"
        class="px-4 py-2 text-sm font-medium text-white bg-primary-600 border border-transparent rounded-md hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200"
      >
        <span *ngIf="!submitting">
          {{ isEditing ? "Update" : "Create" }}
        </span>
        <span *ngIf="submitting" class="flex items-center">
          <div
            class="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"
          ></div>
          {{ isEditing ? "Updating..." : "Creating..." }}
        </span>
      </button>
    </div>
  </form>
</app-modal>

<!-- Delete Confirmation Modal -->
<app-modal
  [show]="showDeleteModal"
  title="Delete Institution"
  (close)="closeDeleteModal()"
>
  <div class="text-center">
    <div
      class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4"
    >
      <i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>
    </div>
    <h3 class="text-lg font-medium text-gray-900 mb-2">Are you sure?</h3>
    <p class="text-sm text-gray-500 mb-6">
      This action cannot be undone. This will permanently delete the institution
      <strong>{{ selectedInstitution?.nameEn }}</strong
      >.
    </p>
    <div class="flex justify-center space-x-3">
      <button
        type="button"
        (click)="closeDeleteModal()"
        class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-200"
      >
        Cancel
      </button>
      <button
        type="button"
        (click)="confirmDelete()"
        [disabled]="submitting"
        class="px-4 py-2 text-sm font-medium text-white bg-red-600 border border-transparent rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200"
      >
        <span *ngIf="!submitting">Delete</span>
        <span *ngIf="submitting" class="flex items-center">
          <div
            class="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"
          ></div>
          Deleting...
        </span>
      </button>
    </div>
  </div>
</app-modal>
