<!-- Page Header -->
<div class="m-4 flex justify-between items-center">
  <div>
    <h1 class="text-2xl font-bold text-gray-900">
      {{ "instructors.pageTitle" | translate }}
    </h1>
    <p class="text-gray-600">{{ "instructors.pageSubtitle" | translate }}</p>
  </div>
</div>

<!-- Data Table Component -->
<app-data-table
  [columns]="tableColumns"
  [data]="instructors"
  [loading]="loading"
  [emptyMessage]="'instructors.empty' | translate"
  [emptyIcon]="'fas fa-chalkboard-teacher'"
  [actions]="tableActions"
  [pagination]="paginationInfo"
  [searchTerm]="searchTerm"
  [showSearch]="true"
  [showPagination]="true"
  [showRefresh]="false"
  (sort)="onTableSort($event)"
  (search)="onTableSearch($event)"
  (refresh)="onTableRefresh()"
  (add)="onTableAdd()"
  (pageChange)="onTablePageChange($event)"
  (pageSizeChange)="onTablePageSizeChange($event)"
  (actionClick)="onTableActionClick($event)"
></app-data-table>

<!-- Add/Edit Instructor Modal -->
<app-modal
  [show]="showModal"
  [title]="
    (isEditing ? 'instructors.editTitle' : 'instructors.addTitle') | translate
  "
  (close)="closeModal()"
>
  <form (ngSubmit)="saveInstructor()" #instructorForm="ngForm">
    <div class="space-y-4">
      <!-- Name English -->
      <div>
        <label
          for="nameEn"
          class="block text-sm font-medium text-gray-700 mb-1"
        >
          {{ "instructors.form.nameEn" | translate }} *
        </label>
        <input
          type="text"
          id="nameEn"
          name="nameEn"
          [(ngModel)]="formData.nameEn"
          required
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
          [placeholder]="'instructors.form.nameEnPlaceholder' | translate"
        />
      </div>

      <!-- Name Arabic -->
      <div>
        <label
          for="nameAr"
          class="block text-sm font-medium text-gray-700 mb-1"
        >
          {{ "instructors.form.nameAr" | translate }} *
        </label>
        <input
          type="text"
          id="nameAr"
          name="nameAr"
          [(ngModel)]="formData.nameAr"
          required
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
          [placeholder]="'instructors.form.nameArPlaceholder' | translate"
        />
      </div>

      <!-- Email -->
      <div>
        <label for="email" class="block text-sm font-medium text-gray-700 mb-1">
          {{ "instructors.form.email" | translate }} *
        </label>
        <input
          type="email"
          id="email"
          name="email"
          [(ngModel)]="formData.email"
          required
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
          [placeholder]="'instructors.form.emailPlaceholder' | translate"
        />
      </div>

      <!-- Phone -->
      <div>
        <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">
          {{ "instructors.form.phone" | translate }}
        </label>
        <input
          type="tel"
          id="phone"
          name="phone"
          [(ngModel)]="formData.phone"
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
          [placeholder]="'instructors.form.phonePlaceholder' | translate"
        />
      </div>

      <!-- Bio -->
      <div>
        <label for="bio" class="block text-sm font-medium text-gray-700 mb-1">
          {{ "instructors.form.bio" | translate }}
        </label>
        <textarea
          id="bio"
          name="bio"
          [(ngModel)]="formData.bio"
          rows="3"
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
          [placeholder]="'instructors.form.bioPlaceholder' | translate"
        ></textarea>
      </div>

      <!-- Image Upload -->
      <div>
        <label for="image" class="block text-sm font-medium text-gray-700 mb-1">
          {{ "instructors.form.profileImage" | translate }}
        </label>
        <div class="mt-1 flex items-center space-x-4">
          <!-- Image Preview -->
          <div *ngIf="imagePreview" class="flex-shrink-0">
            <img
              [src]="imagePreview"
              alt="Profile preview"
              class="h-20 w-20 rounded-full object-cover border-2 border-gray-300"
            />
          </div>

          <!-- Upload Button -->
          <div class="flex-1">
            <input
              type="file"
              id="image"
              name="image"
              accept="image/*"
              (change)="onImageSelected($event)"
              class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary-50 file:text-primary-700 hover:file:bg-primary-100"
            />
            <p class="text-xs text-gray-500 mt-1">
              {{ "instructors.form.imageHint" | translate }}
            </p>
          </div>

          <!-- Remove Button -->
          <button
            *ngIf="imagePreview"
            type="button"
            (click)="removeImage()"
            class="flex-shrink-0 px-3 py-2 text-sm font-medium text-red-600 bg-red-50 border border-red-200 rounded-md hover:bg-red-100 focus:outline-none focus:ring-2 focus:ring-red-500"
          >
            <i class="fas fa-trash mr-1"></i>
            {{ "common.delete" | translate }}
          </button>
        </div>
      </div>

      <!-- Institution -->
      <div>
        <label
          for="institutionId"
          class="block text-sm font-medium text-gray-700 mb-1"
        >
          {{ "instructors.form.institution" | translate }} *
        </label>
        <select
          id="institutionId"
          name="institutionId"
          [(ngModel)]="formData.institutionId"
          required
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
          [class.border-red-500]="
            !formData.institutionId || formData.institutionId <= 0
          "
        >
          <option value="">
            {{ "instructors.form.selectInstitution" | translate }}
          </option>
          <option
            *ngFor="let institution of institutions"
            [value]="institution.id"
          >
            {{ institution.nameEn }}
          </option>
        </select>
        <p
          *ngIf="!formData.institutionId || formData.institutionId <= 0"
          class="text-red-500 text-xs mt-1"
        >
          {{ "instructors.form.selectInstitutionError" | translate }}
        </p>
      </div>
    </div>

    <!-- Modal Actions -->
    <div class="flex justify-end gap-3 mt-6">
      <button
        type="button"
        (click)="closeModal()"
        class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-200"
      >
        {{ "common.cancel" | translate }}
      </button>
      <button
        type="submit"
        [disabled]="instructorForm.invalid || submitting"
        class="px-4 py-2 text-sm font-medium text-white bg-primary-600 border border-transparent rounded-md hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200"
      >
        <span *ngIf="!submitting">
          {{
            isEditing
              ? ("common.update" | translate)
              : ("common.add" | translate)
          }}
        </span>
        <span *ngIf="submitting" class="flex items-center">
          <div
            class="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"
          ></div>
          {{
            isEditing
              ? ("common.updating" | translate)
              : ("instructors.creating" | translate)
          }}
        </span>
      </button>
    </div>
  </form>
</app-modal>

<!-- Delete Confirmation Modal -->
<app-modal
  [show]="showDeleteModal"
  [title]="'instructors.deleteTitle' | translate"
  (close)="closeDeleteModal()"
>
  <div class="text-center">
    <div
      class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4"
    >
      <i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>
    </div>
    <h3 class="text-lg font-medium text-gray-900 mb-2">
      {{ "instructors.deleteConfirmTitle" | translate }}
    </h3>
    <p class="text-sm text-gray-500 mb-6">
      {{ "instructors.deleteConfirmMessage" | translate }}
    </p>
    <div class="flex justify-center space-x-3">
      <button
        type="button"
        (click)="closeDeleteModal()"
        class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-200"
      >
        {{ "common.cancel" | translate }}
      </button>
      <button
        type="button"
        (click)="confirmDelete()"
        [disabled]="submitting"
        class="px-4 py-2 text-sm font-medium text-white bg-red-600 border border-transparent rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200"
      >
        <span *ngIf="!submitting">{{ "common.delete" | translate }}</span>
        <span *ngIf="submitting" class="flex items-center">
          <div
            class="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"
          ></div>
          {{ "common.deleting" | translate }}
        </span>
      </button>
    </div>
  </div>
</app-modal>
